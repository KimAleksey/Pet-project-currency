# üìå Pet-–ø—Ä–æ–µ–∫—Ç. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ ¬´–ó–æ–ª–æ—Ç–∞—è –ö–æ—Ä–æ–Ω–∞¬ª.

## üíª –ß—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ
–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç —á–µ—Ä–µ–∑ API KoronaPay —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ (SCD2) –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ö–•–î (RAW / ODS / DDS), Python –∏ Airflow.
- ‚úîÔ∏è Docker —Å–±–æ—Ä–∫–∞.
- ‚úîÔ∏è DAG–∏ –≤ Airflow.
- ‚úîÔ∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API –ó–æ–ª–æ—Ç–æ–π –∫–æ—Ä–æ–Ω—ã.
- ‚úîÔ∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º –∏ —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL.
- ‚úîÔ∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL.

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≥–æ—Ç–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –∫—É—Ä—Å–∞—Ö –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å –ó–æ–ª–æ—Ç–æ–π –∫–æ—Ä–æ–Ω—ã.
–ü—Ä–æ–µ–∫—Ç:
- ‚úîÔ∏è –ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç —á–µ—Ä–µ–∑ API KoronaPay
- ‚úîÔ∏è –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É raw.korona_transfer_rates
- ‚úîÔ∏è –û–±–Ω–æ–≤–ª—è–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤ ods.korona_transfer_rates
- ‚úîÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∫—É—Ä—Å–æ–≤ (SCD Type 2) –≤ dds.korona_transfer_rates
- ‚úîÔ∏è –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ —á–µ—Ä–µ–∑ Airflow DAG
- ‚úîÔ∏è –†–∞–±–æ—Ç–∞ —Å Sensors –≤ Airflow DAG


## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```md
Pet-project-currency/
‚îú‚îÄ dags/
‚îÇ  ‚îú‚îÄ utils/
‚îÇ  ‚îÇ  ‚îú‚îÄ utils_dict.py # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ INSERT –∑–∞–ø—Ä–æ—Å–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ utils_koronapay_api.py # –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
‚îÇ  ‚îÇ  ‚îú‚îÄ utils_load_to_postgres.py # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Postgres
‚îÇ  ‚îÇ  ‚îú‚îÄ utils_str.py  # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ INSERT –∑–∞–ø—Ä–æ—Å–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ utils_transform.py  # –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ API
‚îÇ  ‚îÇ  ‚îú‚îÄ data/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ codes-all.csv # –ö–æ–¥—ã –≤–∞–ª—é—Ç ISO ISO 4217
‚îÇ  ‚îú‚îÄ etl/
‚îÇ  ‚îÇ  ‚îú‚îÄ raw/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ dag_load_rates_md_raw.py # –ó–∞–≥—Ä—É–∑–∫–∞ raw md —Å–ª–æ—è
‚îÇ  ‚îÇ  ‚îú‚îÄ ods/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ dag_load_rates_ods.py # –ó–∞–≥—Ä—É–∑–∫–∞ ods —Å–ª–æ—è
‚îÇ  ‚îÇ  ‚îú‚îÄ dds/
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ dag_load_rates_md_raw.py # –ó–∞–≥—Ä—É–∑–∫–∞ dds md —Å–ª–æ—è
‚îÇ  ‚îú‚îÄ handles/
‚îÇ  ‚îÇ  ‚îú‚îÄ dwh/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ create_schemas.py # –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ create_tables.py # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
‚îÇ  ‚îÇ  ‚îî‚îÄ oltp/
‚îÇ  ‚îÇ     ‚îú‚îÄ execute_custom_query.py # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ SQL –≤ PostgreSQL.
‚îÇ  ‚îÇ     ‚îî‚îÄ get_postgres_credentials.py # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ requirements.txt                 # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ README.md                        # —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ config
‚îÇ  ‚îî‚îÄ .env                          # –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ä–µ–ø–æ)
‚îú‚îÄ .venv/                           # –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ä–µ–ø–æ)
‚îú‚îÄ Dockerfile                       # Docker –æ–±—Ä–∞–∑ –¥–ª—è Airflow –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ docker-compose.yaml              # Docker compose –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ pyproject.toml                   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ uv.lock                          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/KimAleksey/Pet-project-currency.git
cd Pet-project-currency
```

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install --upgrade pip && \
pip install uv && \
uv venv activate && \
uv install
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å Airflow –∏ DB
```bash
docker compose up -d
```

## üßë‚Äçüíª–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ DB
–í –ø–∞–ø–∫–µ config —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env.
–ï—Å–ª–∏ –Ω–µ –º–µ–Ω—è–ª–∏ docker-compose, —Ç–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:
```text
POSTGRES_DB="demo"
POSTGRES_HOST="localhost"
POSTGRES_PORT=5433
POSTGRES_USER="postgres"
POSTGRES_PASSWORD="postgres"
```
–ï—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –Ω–æ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –∏—Ö –≤ —Ç–µ–∫—Å—Ç–µ –≤—ã—à–µ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª .env.

### –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã –∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
```bash
python -m handles.dwh.create_schemas
python -m handles.dwh.create_tables
```

### –ó–∞–ø—É—Å–∫ Airflow
–í–µ–±-—Å–µ—Ä–≤–µ—Ä Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ http://localhost:8080/, –µ—Å–ª–∏ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ö–æ—Å—Ç, 
—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Ö–æ—Å—Ç—É http://0.0.0.0:8080/.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –ø–∞—Ä–æ–ª—å: airflow, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–ª–∏ –≤ docker compose.

### –°–æ–∑–¥–∞–Ω–∏–µ connection Airflow
–ó–∞–π—Ç–∏ –≤ Airflow -> Admin -> Connections:
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```text
Connection Id = my_dwh
Connection Type = Postgres
Description = Postgres
Host = my_db
Database = demo
Login = postgres
Password = postgres
Port = 5432
```
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –º–µ–Ω—è–ª–∏ –≤ docker compose, —Ç–æ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

### –ó–∞–ø—É—Å–∫ DAG
–í Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ DAG:
- ‚úîÔ∏è dag_for_loading_data_to_md_raw
- ‚úîÔ∏è dag_for_loading_ods_rates
- ‚úîÔ∏è dag_for_loading_dds_rates

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DB Postgres
–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ DB —á–µ—Ä–µ–∑ DBeaver (–Ω–∞–ø—Ä–∏–º–µ—Ä).
–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:
```text
Connection Type = Postgres
Description = Postgres
Host = localhost
Database = demo
Login = postgres
Password = postgres
Port = 5433
```